.. _analysis-types:

Analysis types
==============

.. _genomic:

Genomic
-------

Genomic analysis provides information for quality evaluation of the alignment data: base statistics summary showing mean GC-content, coverage, mapping quality and also a number of useful graphs, that allow to evaluate the quality of the sequencing data.
 
Input
^^^^^

:guilabel:`BAM file` 
  Path to the sequence alignment file in BAM format.

:guilabel:`Draw chromosome limits` 
  If selected, vertical dotted lines will be placed at the beginning of each chromosome according to the information found in the header of the BAM file.

:guilabel:`Analyze regions` 
  Activating this option results in analysis of the alignment data only in specified region. 

:guilabel:`GFF file` 
  The path to the annotation file that specifies regions of interest.

:guilabel:`Analyze outside regions` 
  This option allows to provide the information about the alignment data outside of the regions of interest. Useful for comparison purposes.

:guilabel:`Compare GC content distribution with...` 
  Option allows to compare calculated distribution with selected precalculated genome distribution. Currently two genome distributions are available: human (hg19) and mouse (mm9)

Advanced parameters
"""""""""""""""""""

:guilabel:`Number of windows` 
  Number of windows used to split the selected genome reference. Default is 400.

:guilabel:`Number of threads` 
  The genomic analysis computation can be performed in parallel on a multicore system using the given number of threads. The default number of threads equals number of available processors.

:guilabel:`Size of the bunch` 
  To speed up the computation reads are analyzed in bunches. Each bunch is analyzed by single thread. This option controls the number of reads in bunch. Smaller number may result in lower performance, but also the memory consumption will be reduced. 


Output
^^^^^^

:guilabel:`Summary` 
  Basic information and statistics for the alignment sequencing input. For example, number of reads, number of mapped reads, mean coverage, chromosome-based statistics, etc.

:guilabel:`Input data & parameters` 
  Section provides the information about selected input parameters. 

:guilabel:`Coverage arcross reference` 
  This plot consists of two figures. The upper figure provides the coverage (red color) and coverage deviation across the reference sequence. The lower figure show gc-content across reference (black color) and it’s deviation. 

:guilabel:`Coverage` 
  Histogram Frequency histogram of the coverage.

:guilabel:`Coverage histogram (0-50X)` 
  There is often big picks of coverage across the reference and the scale of the Coverage Histogram graph scale may not be adequate. In order to solve this, in this graph genome locations with a coverage greater than 50X are groped into the last bin. 

:guilabel:`Coverage quota`
  Provides an easy way of viewing how much reference has been sequenced with a coverage higher than a selected level.

:guilabel:`Reads content per position` 
  This plot demonstrates the nucleotide content per read position.

:guilabel:`GC content per read` 
  This graph shows the distribution of GC content per read. When compared with genome distribution this plot allows to check if there is a shift in the GC content. 

:guilabel:`Unique reads per position` 
  The histogram shows how many reads start at unique position. This plot is helpful to see if the fragment distribution across genome. 

:guilabel:`Mapping quality across reference` 
  Plot provides mapping quality across reference as indicate by the parameters.

:guilabel:`Mapping quality histogram` 
  Histogram of the mapping quality frequency

.. _rna-seq:

RNA-seq
-------

In RNA-seq experiments, the reads are mapped to a reference genome. If the total amount of sequencing reads is enough, the number of those reads mapping to a certain biological feature of interest (gene,
transcript, exon, ...) is an estimation of the abundance of that feature in the sample and can be used
as the quantification of its expression level. 

These count data are usually utilized to assess differential expression between two or more experimental conditions. But before computing differential expression, users should be aware of some potential limitations of the RNA-seq data they are working with, as for example: has the saturation been reached or could more features be detected by increasing sequencing  depth? Which kind of features are being detected in the experiment? how good is the quantification of expression in the sample? All of these questions are easily answered by looking at the plots generated by Qualimap.

To study the quality of a sample from the count data in a RNA-seq experiment, please use the
RNA-seq option from the Analysis menu. 

For this option to work, the R language must be installed in the user’s computer along with the R library “optparse” (both are freely available from http://cran.r-project.org/ ).

Input
^^^^^

:guilabel:`First sample (counts)` 
  File containing the count data from sample. Count data must be provided in a tab-delimited txt file, with the features names or IDs in the first column and counts in the second column. This file must not contain any header or column names. One can calculate the counts from a GFF file and a BAM file using option :menuselection:`Tools --> Compute Counts`

:guilabel:`First sample name` 
  Name for sample 1 to appear in plots legends

:guilabel:`Second sample (counts)` 
  Optional. If a second sample is available, this file should contain the same information as in :guilabel:`First sample`, but for the second sample. Mark the :guilabel:`Compare with other sample` box to enable this option.

:guilabel:`Second sample name` 
  Name for second sample to appear in plots legends.

:guilabel:`Count threshold` 
  A feature is considered as detected if the corresponding number of counts isgreater than this count threshold. By default, the theshold value is set to 5 counts.

:guilabel:`Info File` 
  Optional. File containing the biological classification of features in the count files. The info file must be a tab-delimited txt file, with the features names or IDs in the first column and the biological group (e.g. the biotype field from Biomart in the Ensembl database) in the second column. Again, the file must not contain any header or column names. If this file is provided, further exploratory plots can be generated to evaluate characteristics of the sample such us the kind of features being detected or the counts distribution for detected features. Please, make sure that the features IDs are the same in the :guilabel:`Info file` and in the :guilabel:`Count file`.

:guilabel:`Species` 
  Optional. If the Info File is not given by the user, Qualimap provides the Ensembl biotype classification for certain species (human and  mouse in Qualimap version 1.0), whenever the features names in the counts file are the Ensembl gene or transcripts IDs (e.g. ENSG00000251282 or ENST00000508921). If so, mark the box to enable this option and select the species. 

Output
^^^^^^

:guilabel:`Global Saturation`

  This plot provides information about the level of saturation in the sample, so it helps the user to decide if more sequencing is needed or if no many more features will detected when increasing the number of reads. These are some tips for the interpretation of the plot: 
  
  * The increasing sequencing depth of the sample is represented at the X-axis. The maximum value is the real sequencing depth of the sample(s). Smaller sequencing depths correspond to samples   randomly generated from the original sample(s).
  *  The curve(s) is associated to the left Y-axis and represents the number of detected features when working with each of the sequencing depths in the X-axis. “Detected features” mean features with more than k counts, where k is the Count threshold chosen by the user.
  * The bars are associated to the right Y-axis and they represent the number of newly detected features when increasing the sequencing depth in one million reads at each sequencing depth value.

When an :guilabel:`Info File` is provided by the user or chosen from the ones supplied by Qualimap, a series of plots are additionally generated that are described next.

:guilabel:`Detection per group`
  This barplot allows the user to know which kind of features are being detected in their sample(s). The X-axis shows all the biological groups included in the Info file (or the biotypes supplied by Qualimap). The grey bar is the percentage of features in each biological group within the reference genome (or transcriptome, etc.). The striped color bar is the percentage detected in the sample with regard to the genome. The solid color bar is the percentage that the group (or biotype) represents in the total detected features in the sample.
:guilabel:`Counts per group`
  A boxplot per each group (or biotype) describes the counts distribution for the detected features in that group.
:guilabel:`Saturation per group`
 For each group (or biotype), a saturation plot is generated like the one described above.
:guilabel:`Counts & Sequencing Depth`
  For each group (or biotype), a plot is generated containing a boxplot with the distribution of counts at each sequencing depth. X-axis shows the increasing sequencing depths of randomly generated samples from the original one till the true sequencing depth is reached. This plot allows the user to see how the increase of sequencing depth is changing the expression level quantification. 

.. _epigenomic:

Epigenomic (Clustering)
------------------------

This analysis type allows to cluster the regions of interest in the input alignment based on the coverage. Typical usecase for such clustering can be evaluation of epigenomics experiment. For example due to epigenetics changes When analyzing promoter regions one should expect some genes to be activated and some silenced. 

To perform this evaluation you need to provide alignment data ( both methylated and control) and list of transcript ids as BED annotation file.

Input
^^^^^

:guilabel:`Experiment ID`
  The experiment name

:guilabel:`Alignment data`
  Here you can provide your replicates to analyze. Each replicate includes sample file and a control file. For example, in an epigenomics experiment, the sample file could be the MeDIP-seq data and the control the non-encriched data (the so-called INPUT data). Thus, for each replicate the following information has to be provided:

  :guilabel:`Replicate name` 
    Name of the replicate
  :guilabel:`Sample file` 
    Path to sample BAM file
  :guilabel:`Control file` 
    Path to control BAM file

  To add a replicate click :guilabel:`Add` button. To remove a replicate select it and click :guilabel:`Remove` button. You can modify replicate by using :guilabel:`Edit` button.

:guilabel:`Regions of interest` 
  Path to an annotation file in BED format which contains regions of interest.
  The BED file should be a tab delimited text file with exactly 6 fields per line:
  
  * chromosome
  * start
  * end
  * name
  * score
  * strand (+ or -)

:guilabel:`Location` 
  Relative location to analyze 
:guilabel:`Left offset` 
  Offset in bp upstream the selected regions
:guilabel:`Right offset` 
  Offset in bp downstream the selected regions
:guilabel:`Bin size` 
  Can be thought as the resolution of the plot. Bins of the desired size will be computed and the information falling on each bin will be aggregated
:guilabel:`Number of clusters` 
  Number of groups that you the user wants to divide the data. Several values can be used by separting them with commas
:guilabel:`Fragment length` 
  Length of the fragments that were initially sequenced. All reads will be enlarged to this length.
:guilabel:`Visualization type` 
  You can visualize cluster using heatmaps or line-based graphs

Output
^^^^^^

After the analysis is performed, the regions of interest are clustered in groups based on the coverage pattern. The output graph shows the coverage pattern for each cluster either as a heatmap or a line graph. There can be multiple graphs based on the number of clusters provided as input. The name of each graph consists of the experiment name and the number of clusters. 

It is possible to export list of features beloning to the particular cluster. To do this use main menu item :menuselection:`File --> Export gene list` or context menu item :menuselection:`Export gene list`. After activating the item a dialog will appear where you can choose some specific cluster. One can either copy the list of features belonging to this cluster in the clipboard or export it to a text file. 

.. _compute-counts:

Compute counts
--------------

This tool allows to calculate how many reads belong to each region if interest in the alignment. To access the tool use menu item :menuselection:`Tools --> Compute counts`. 

Input
^^^^^

:guilabel:`BAM file` 
  Path to BAM alignment file
:guilabel:`Annotation file` 
  Path to GTF file containing regions of interest
:guilabel:`Protocol` 
  Three options are avalalbe:

  :dfn:`non-strand-specific` 
    Feature is counted independent of strand
  :dfn:`forward-stranded` 
    Feature is counted only if it has the same strand as the read
  :dfn:`reverse-strand` 
    Feature is counted only if the it has the strand reverse to the one of the read

:guilabel:`Feature type`
  Third column of the GTF file. Only features of this particular type are counted.
:guilabel:`Feature name`
  The name of the feature to be counted.
:guilabel:`Output`
  Path to the file which will contain output.
:guilabel:`Save computation summary`
  This option controls whether to save overall computation statistics.



